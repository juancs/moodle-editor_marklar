define(["jquery","core/yui","core/str","editor_marklar/filepicker"],function(a,b,c,d){"use strict";function e(a,b){this.textarea=a,this.panel=a.parent().next(),this.initparams=b,"undefined"!=typeof M.editor_marklar.fpoptions[b.elementid]&&(this.initparams.filepickeroptions=M.editor_marklar.fpoptions[b.elementid]),this.initFilesEmbedding()}return e.prototype.initFilesEmbedding=function(){if(!("filepickeroptions"in this.initparams))return void console.error(this.initparams.elementid+": File picker options not found");var e=this;b.use("core_filepicker",function(){e.filepicker=d.init(e.initparams.filepickeroptions),e.filepicker.canShowFilepicker("image")&&c.get_string("insertimage","editor_marklar").done(function(b){var c=a("<button/>");c.text(b),c.click(function(a){a.preventDefault(),e.filepicker.showFilepicker("image",function(a){e.imageEmbedded(a)})}),e.panel.append(c)}),e.filepicker.canShowFilepicker("link")&&c.get_string("insertlink","editor_marklar").done(function(b){var c=a("<button/>");c.text(b),c.click(function(a){a.preventDefault(),e.filepicker.showFilepicker("link",function(a){e.insertLink(a)})}),e.panel.append(c)})})},e.prototype.imageEmbedded=function(a){"url"in a&&this.insertText('<img alt="" class="img-responsive" src="'+a.url+'"/>')},e.prototype.insertLink=function(a){if("url"in a){var b;b="file"in a&&a.file?a.file.replace(/(\[|\])/g,"_"):"texttoshow",this.insertText("["+b+"]("+a.url+")")}},e.prototype.insertText=function(a){this.textarea.val(this.textarea.val()+"\n\n"+a)},{init:function(b){var c;if(!("elementid"in b))throw new Error("editor_marklar: Invalid editor init parameter - missing elementid");if(c=a(document.getElementById(b.elementid)),c.length)return new e(c,b);throw new Error("Unable to find textarea element",b.elementid)}}});